#### 分布式系统的CAP
* CAP
    1. Consistency一致性
    2. Availability可用性
    3. Partition Tolerance分区容错性
* 分布式系统中不能兼顾CAP
#### 一般的分布式主从模式
* 一般模式的主从架构，多台主机，其中一台做Master进行服务工作，然后同步数据给若干slave节点，
    主节点有读写，而从节点只能读。
#### ZK对外服务的一致性
* 而对于ZK的主从架构，其做了一些调整
    1. 主从节点均可以接受客户端的请求
    2. 从节点(learner)只可以进行查询，当涉及到增删改时，从节点将请求发给master（leader）节点，leader
        首先征询**包括leader自身的过半节点**的确认信息。其次，做修改并通过为每个节点分配一个消息队列，发送已经修改
        的信息给所有节点。要求所有节点都确认以保证一致性。
        * 同时从(learner)节点又可以细分，当slave节点数量很多的时候，为了解决通信慢的问题，将从节点分为follower与observer两种节点
            1. follower节点：它参与服务，当服务是非读操作时，转发请求给leader，并参与投票
            2. observer节点：只负责读操作与转发请求给leader，不参与投票操作
#### ZK对内的协调的原则
* 选取leader节点，主要依靠两个指标
    1. sid服务器的编号
        * 在启动ZK集群之前就需要决定好各个节点的sid
    2. zxid当前服务器上的最新事务的编号
        * 每完成一个蹭删改的事务，就增加同步更新一下各个节点的事务id
    * 在初次启动ZK集群的时候若是同时启动的情形，则编号最大的节点就是leader节点，
        若是一个一个启动的ZK节点，则编号最大的节点不一定leader节点
    * 在服务的过程中，若leader突然挂了，则此时的选举机制就是，选取所有存活的节点中事务ID最新的那一批节点中
        sid最大的那个节点作为新的leader节点
        * 原因是，选取zxid最新（最大）的一批节点，就保证这批节点是最新状态的节点，用来保证数据的一致性
#### ZK的特征
1. 最终一致性
2. 可靠性
3. 实时性
    * ZK不能保证两个客户端能同时得到刚更新的数据，如果需要最新的数据，则需要在读取数据之前调用sync接口
4. 独立性
5. 原子性
6. 顺序性

    
    
